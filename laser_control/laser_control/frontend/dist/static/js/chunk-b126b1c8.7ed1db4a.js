(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b126b1c8"],{"0f66":function(e,t,a){"use strict";a.d(t,"i",function(){return s}),a.d(t,"c",function(){return i}),a.d(t,"g",function(){return o}),a.d(t,"j",function(){return r}),a.d(t,"d",function(){return l}),a.d(t,"e",function(){return c}),a.d(t,"b",function(){return d}),a.d(t,"h",function(){return u}),a.d(t,"a",function(){return h}),a.d(t,"f",function(){return p});var n=a("b775");function s(e){return Object(n["a"])({url:"/node/store",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/node/batch_store",method:"post",data:e})}function o(){return Object(n["a"])({url:"/node/list",method:"get"})}function r(e){return Object(n["a"])({url:"/node/update",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/node/change_role",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/node/delete",method:"post",data:e})}function d(e){return Object(n["a"])({url:"/node/batch_delete",method:"post",data:e})}function u(){return Object(n["a"])({url:"/node/list_shards",method:"get",timeout:2e4})}function h(e){return Object(n["a"])({url:"/node/ansible",method:"post",data:e})}function p(e){return Object(n["a"])({url:"/node/operation_info",method:"get",params:e})}},"121a":function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a("b775");function s(e){return Object(n["a"])({url:"/tools/assign_table_shard_list",method:"get",timeout:1e5,params:e})}},"15e2":function(e,t,a){},"1c49":function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"b",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"a",function(){return r});var n=a("b775");function s(e){return Object(n["a"])({url:"/node_config/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/node_config/store",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/node_config/update",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/node_config/delete",method:"post",data:e})}},"23ba":function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return i}),a.d(t,"e",function(){return o}),a.d(t,"d",function(){return r}),a.d(t,"b",function(){return l});var n=a("b775");function s(e){return Object(n["a"])({url:"/group/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/group/store",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/group/update",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/group/reduce_metrics",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/group/delete",method:"post",data:e})}},"2fea":function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"b",function(){return r});var n=a("b775");function s(e){return Object(n["a"])({url:"/machine_category/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/machine_category/store",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/machine_category/update",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/machine_category/delete",method:"post",data:e})}},"322e":function(e,t,a){},"360e":function(e,t,a){},"5ce7":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-form",{ref:"searchForm",staticStyle:{"margin-left":"20px"},attrs:{model:e.filterParams}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:2}},[a("el-checkbox",{staticClass:"filter-item",staticStyle:{"margin-top":"10px","margin-left":"0px"},on:{change:function(t){e.filterParams.enable=t}}},[e._v("\n            过滤数据表:\n          ")])],1),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-form-item",[a("el-input",{attrs:{clearable:""},model:{value:e.filterParams.tableName,callback:function(t){e.$set(e.filterParams,"tableName",t)},expression:"filterParams.tableName"}})],1)],1)],1)],1),e._v(" "),e._l(e.list,function(t){return a("el-tab-pane",{attrs:{label:t.DescName,name:t.GroupName}},[a("nodeView",{attrs:{nodeList:t.Nodes,shardList:e.shardData,shards:e.shards,relations:e.relations,groupName:t.GroupName,groupId:t.Id}})],1)})],2)],1)},s=[],i=(a("55dd"),a("6762"),a("2fdb"),a("ac6a"),a("0f66")),o=a("6724"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{gutter:20,type:"flex",justify:"start"}},[a("el-col",[a("ansibleOperation",{ref:"AnsibleOperation",staticStyle:{"margin-left":"10px"},attrs:{nodesToOperateOn:e.nodesToOperateOn,operations:e.operations,groupName:e.groupName,groupId:e.groupId},on:{handleBatchCreate:e.handleBatchCreate,handleEnableBatchOperation:e.handleEnableBatchOperation,batchDeleteNodes:e.batchDeleteNodes,postAnsibleOperation:e.postAnsibleOperation}})],1),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br")],1),e._v(" "),a("el-row",{attrs:{gutter:20,align:"middle"}},[e._l(e.nodeList,function(t){return a("el-col",{key:t.Id,staticStyle:{"margin-bottom":"10px"},attrs:{span:6}},[a("el-card",{staticClass:"box-card",style:e._f("cardStyle")(t)},[a("div",{staticClass:"clearfix",style:e._f("cardHeader")(t),attrs:{slot:"header"},slot:"header"},[e.enableBatchOperation?a("el-checkbox",{staticClass:"filter-item",on:{change:function(a){return e.onNodeChecked(a,t)}}}):e._e(),e._v(" "),a("span",{staticStyle:{"font-size":"18px","font-weight":"600"}},[e._v("["+e._s(t.NodeId)+"] "+e._s(t.Host)+":"+e._s(t.Port))]),e._v(" "),t.Master?a("el-tag",{attrs:{type:"success",effect:"dark",size:"mini"}},[e._v("主")]):e._e()],1),e._v(" "),a("el-row",{attrs:{"style:":"margin: 10px 0px"}},[a("el-col",{attrs:{span:8}},[a("span",[e._v(" 读 KPS: ")])]),e._v(" "),a("el-col",{attrs:{span:16}},[a("span",[e._v(" "+e._s(t.ReadKps)+" ")])])],1),e._v(" "),a("br"),e._v(" "),a("el-row",{attrs:{"style:":"margin: 10px 0px"}},[a("el-col",{attrs:{span:8}},[a("span",[e._v(" 写 KPS: ")])]),e._v(" "),a("el-col",{attrs:{span:16}},[a("span",[e._v(" "+e._s(t.WriteKps)+" ")])])],1),e._v(" "),a("div",[a("el-divider",{staticStyle:{margin:"10px"}},[a("i",{staticClass:"el-icon-more"})])],1),e._v(" "),a("el-row",{attrs:{justify:"center"}},[a("el-col",{attrs:{span:6}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"启用节点",placement:"top"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-video-play",circle:""},on:{click:function(a){return e.handleNodeCommand(e.operations.enable.Name,t)}}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"暂停节点",placement:"top"}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-video-pause",circle:""},on:{click:function(a){return e.handleNodeCommand(e.operations.disable.Name,t)}}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"详细信息",placement:"top"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-s-operation",circle:""},on:{click:function(a){return e.handleShowDetail(t)}}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-dropdown",{attrs:{"hide-on-click":!0},on:{command:function(a){return e.handleNodeCommand(a,t)}}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-more",circle:""}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:e.operations.start.Name}},[e._v("启动")]),e._v(" "),a("el-dropdown-item",{attrs:{command:e.operations.stop.Name}},[e._v("停止")]),e._v(" "),a("el-dropdown-item",{attrs:{command:e.operations.restart.Name}},[e._v("重启")]),e._v(" "),a("el-dropdown-item",{attrs:{command:e.operations.upgrade.Name}},[e._v("更新")]),e._v(" "),a("el-dropdown-item",{attrs:{command:e.operations.delete.Name}},[e._v("删除")])],1)],1)],1)],1)],1)],1)}),e._v(" "),a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:6}},[a("el-card",{staticClass:"box-card",staticStyle:{"text-align":"center",height:"270px"}},[a("el-button",{staticClass:"button",staticStyle:{"font-size":"8rem",height:"220px"},attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.handleCreate}})],1)],1)],2),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,width:"90%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",[a("h3",[e._v("节点信息")]),e._v(" "),a("el-divider"),e._v(" "),a("el-form",{ref:"dataForm",staticStyle:{width:"700px","margin-left":"50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"所属组",prop:"GroupName"}},[a("el-select",{staticClass:"el-select",attrs:{loading:e.listGroupLoading,placeholder:"请选择"},on:{"visible-change":e.fetchGroupList,change:function(t){return e.getGroupIdByName(e.temp.GroupName)}},model:{value:e.temp.GroupName,callback:function(t){e.$set(e.temp,"GroupName",t)},expression:"temp.GroupName"}},e._l(e.groupList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"节点Id",prop:"NodeId"}},[a("el-input",{attrs:{type:"number",min:"1",oninput:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.temp.NodeId,callback:function(t){e.$set(e.temp,"NodeId",e._n(t))},expression:"temp.NodeId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"Host"}},[a("machineSelection",{ref:"MachineSelection",attrs:{multipleSelection:!1,selectedMachines:e.temp.Host},on:{"update:selectedMachines":function(t){return e.$set(e.temp,"Host",t)},"update:selected-machines":function(t){return e.$set(e.temp,"Host",t)}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口",prop:"Port"}},[a("el-input",{attrs:{type:"number",min:"0",max:"65535",oninput:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.temp.Port,callback:function(t){e.$set(e.temp,"Port",e._n(t))},expression:"temp.Port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"配置",prop:"ConfigName"}},[a("el-select",{staticClass:"el-select",attrs:{loading:e.listConfigLoading,placeholder:"请选择"},on:{"visible-change":e.fetchConfigList,change:function(t){return e.getConfigIdByName(e.temp.ConfigName)}},model:{value:e.temp.ConfigName,callback:function(t){e.$set(e.temp,"ConfigName",t)},expression:"temp.ConfigName"}},e._l(e.configList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"启动配置",prop:"AnsibleConfigId"}},[a("ansibleConfigSelection",{attrs:{ansibleConfigId:e.temp.AnsibleConfigId},on:{"update:ansibleConfigId":function(t){return e.$set(e.temp,"AnsibleConfigId",t)},"update:ansible-config-id":function(t){return e.$set(e.temp,"AnsibleConfigId",t)}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主节点",prop:"Master"}},[a("el-switch",{attrs:{"active-text":e.yesNoText[1],"inactive-text":e.yesNoText[0],"active-value":!0,"inactive-value":!1,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.roleChanged},model:{value:e.temp.Master,callback:function(t){e.$set(e.temp,"Master",t)},expression:"temp.Master"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"边缘节点",prop:"IsEdgeNode"}},[a("el-switch",{attrs:{"active-text":e.yesNoText[1],"inactive-text":e.yesNoText[0],"active-value":!0,"inactive-value":!1,"active-color":"#13ce66","inactive-color":"#ff4949",disabled:1==e.temp.Master},model:{value:e.temp.IsEdgeNode,callback:function(t){e.$set(e.temp,"IsEdgeNode",t)},expression:"temp.IsEdgeNode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"激活",prop:"Active"}},[a("el-switch",{attrs:{"active-text":e.yesNoText[1],"inactive-text":e.yesNoText[0],"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.temp.Active,callback:function(t){e.$set(e.temp,"Active",t)},expression:"temp.Active"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主分片列表",prop:"LeaderShardList"}},[a("el-input",{attrs:{type:"textarea",disabled:0==e.temp.Master},on:{change:e.removeDuplicateLeaderShards},model:{value:e.tempLeaderShards,callback:function(t){e.tempLeaderShards=t},expression:"tempLeaderShards"}})],1),e._v(" "),0==e.temp.IsEdgeNode?a("div",[a("el-form-item",{attrs:{label:"从分片列表",prop:"FollowerShardList"}},[a("el-input",{attrs:{type:"textarea",disabled:1==e.temp.Master},on:{change:e.removeDuplicateFollowerShards},model:{value:e.tempFollowerShards,callback:function(t){e.tempFollowerShards=t},expression:"tempFollowerShards"}})],1)],1):a("div",[a("el-form-item",{attrs:{label:"从分片列表",prop:"FollowerShardList"}},[a("div",{staticStyle:{width:"640px"},attrs:{"label-position":"left"}},[e.tempEdgeNodeFollowerShards.ShardsList.length>0?a("el-form",{ref:"followerShardListForm",attrs:{model:e.tempEdgeNodeFollowerShards}},e._l(e.tempEdgeNodeFollowerShards.ShardsList,function(t,n){return a("el-row",{key:n,attrs:{gutter:5}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:t.Table,"label-width":"250px",prop:"ShardsList."+n+".Shards",rules:e.followerShardListRules.Shards}},[a("el-input",{attrs:{type:"textarea",clearable:""},on:{change:e.removeDuplicateFollowerShards},model:{value:t.Shards,callback:function(a){e.$set(t,"Shards",a)},expression:"tableShards.Shards"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{staticStyle:{"margin-top":"30px"},attrs:{size:"mini"},on:{click:function(a){return a.preventDefault(),e.handleDeleteTable(t)}}},[e._v("删除\n                  ")])],1)],1)}),1):e._e(),e._v(" "),e.addNewTableFlag?a("el-form",{ref:"selectTableForm",staticStyle:{"margin-top":"20px"},attrs:{model:e.selectTable,rules:e.SelectTableRules}},[a("el-row",{attrs:{gutter:5}},[a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{prop:"nodeSelectedTable"}},[a("el-cascader",{attrs:{options:e.tableOption},on:{"visible-change":e.fetchTableList,change:e.judgeTableExists},model:{value:e.selectTable.nodeSelectedTable,callback:function(t){e.$set(e.selectTable,"nodeSelectedTable",t)},expression:"selectTable.nodeSelectedTable"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{staticStyle:{"margin-left":"8px"},attrs:{prop:"nodeSelectedTableShards"}},[a("el-input",{attrs:{type:"textarea",clearable:""},on:{change:e.removeSelectedTableFollowerDuplicateShards},model:{value:e.selectTable.nodeSelectedTableShards,callback:function(t){e.$set(e.selectTable,"nodeSelectedTableShards",t)},expression:"selectTable.nodeSelectedTableShards"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"mini"},on:{click:function(t){return t.preventDefault(),e.handelDeleteSelectedTable(t)}}},[e._v("删除\n                  ")])],1)],1)],1):e._e()],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"0px","margin-top":"30px"},attrs:{size:"mini"},on:{click:function(t){return e.handleAddNewTable(e.addNewTableFlag)}}},[e._v("\n              添加数据表\n          ")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.temp.Desc,callback:function(t){e.$set(e.temp,"Desc",t)},expression:"temp.Desc"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"default"},slot:"default"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createNode():e.updateNode()}}},[e._v("\n        提交\n      ")])],1),e._v(" "),1==e.dialogShardsVisible?a("div",[a("h3",[e._v("分片信息")]),e._v(" "),a("el-divider"),e._v(" "),a("el-row",e._l(e.currentNodeShards,function(e){return a("el-col",{key:e.id,attrs:{xs:2,sm:4,md:3,lg:2,xl:1}},[a("shardView",{attrs:{shardInfo:e}})],1)}),1)],1):e._e()]),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogBatchCreateVisible,width:"40%"},on:{"update:visible":function(t){e.dialogBatchCreateVisible=t}}},[a("batchCreate",{attrs:{configList:e.configList,groupId:e.groupId,nodeList:e.nodeList},on:{getConfig:e.fetchConfigList,postCreate:e.postBatchCreate}})],1)],1)},l=[],c=(a("ffc1"),a("4f7f"),a("1c4c"),a("28a5"),a("456d"),a("5df3"),a("f400"),a("c5f6"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-popover",{attrs:{placement:"right",width:"560",trigger:"click"},on:{show:e.showDetail}},[e.displayDetail?a("div",[a("el-divider",{staticStyle:{margin:"0px"}},[e._v("当前节点分片信息")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:4}},[e._v("集群分组:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(e.shardInfo.groupName))]),e._v(" "),a("el-col",{attrs:{span:4}},[e._v("节点 ID:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(e.shardInfo.nodeId))])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:4}},[e._v("当前版本:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(e.shardInfo.baseVersionHash))]),e._v(" "),a("el-col",{attrs:{span:4}},[e._v("更新序列:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(e.shardInfo.seqNo))])],1),e._v(" "),a("el-divider",{staticStyle:{margin:"0px"}},[e._v("其他备份节点信息")]),e._v(" "),e._l(e.shardInfo.relations,function(t){return a("el-row",{key:t.shardHash},[a("el-col",{attrs:{span:3}},[a("div",{staticClass:"shard",style:e._f("shardStyle")(t)},[a("span",{staticStyle:{"font-weight":"700",margin:"2px"}},[e._v(e._s(t.shardId))]),e._v(" "),1!==t.serviceState?a("div",{staticClass:"shard-service"},[a("i",{staticClass:"el-icon-close",staticStyle:{"font-weight":"bold"}})]):e._e(),e._v(" "),t.noDiff||2!==t.role?e._e():a("div",{staticClass:"shard-data"},[a("i",{staticClass:"el-icon-loading",staticStyle:{"font-weight":"bold"}})])])]),e._v(" "),a("el-col",{attrs:{span:21}},[a("el-row",[a("el-col",{attrs:{span:4}},[e._v("集群分组:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(t.groupName))]),e._v(" "),a("el-col",{attrs:{span:4}},[e._v("节点 ID:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(t.nodeId))])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:4}},[e._v("当前版本:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(t.baseVersionHash))]),e._v(" "),a("el-col",{attrs:{span:4}},[e._v("更新序列:")]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v(e._s(t.seqNo))])],1)],1)],1)})],2):e._e(),e._v(" "),a("div",{staticClass:"shard",style:e._f("shardStyle")(e.shardInfo),attrs:{slot:"reference"},slot:"reference"},[a("span",{staticStyle:{"font-weight":"700",margin:"2px"}},[e._v(e._s(e.shardInfo.shardId))]),e._v(" "),1!==e.shardInfo.serviceState?a("div",{staticClass:"shard-service"},[a("i",{staticClass:"el-icon-close",staticStyle:{"font-weight":"bold"}})]):e._e(),e._v(" "),e.shardInfo.noDiff||2!==e.shardInfo.role?e._e():a("div",{staticClass:"shard-data"},[a("i",{staticClass:"el-icon-loading",staticStyle:{"font-weight":"bold"}})])])])],1)}),d=[],u={directives:{waves:o["waves"]},props:{shardInfo:{type:Object,default:function(){return{}}}},filters:{shardStyle:function(e){return 1===e.role?"background:#80c27e":"background:#5592c2"}},data:function(){return{displayDetail:!1}},created:function(){},methods:{showDetail:function(){this.displayDetail=!0}}},h=u,p=(a("680a"),a("2877")),f=Object(p["a"])(h,c,d,!1,null,null,null),m=f.exports,b=a("23ba"),g=a("1c49"),v=a("61f7"),N=a("cf45"),S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:20,align:"middle"}},[a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:6}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"10px"},attrs:{rules:e.rules,model:e.createParams,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"Laser 数据库",prop:"DatabaseName"}},[a("el-select",{staticClass:"el-select",attrs:{loading:e.listDBLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDatabase,change:function(t){return e.getDatabaseIdByName(e.createParams.DatabaseName)}},model:{value:e.createParams.DatabaseName,callback:function(t){e.$set(e.createParams,"DatabaseName",t)},expression:"createParams.DatabaseName"}},e._l(e.databaseList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Laser 数据表",prop:"TableName"}},[a("el-select",{staticClass:"el-select",attrs:{loading:e.listTableLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDataTable},model:{value:e.createParams.TableName,callback:function(t){e.$set(e.createParams,"TableName",t)},expression:"createParams.TableName"}},e._l(e.tableList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"分配方式",prop:"Type"}},[a("el-select",{staticClass:"el-select",attrs:{placeholder:"请选择"},model:{value:e.createParams.Type,callback:function(t){e.$set(e.createParams,"Type",t)},expression:"createParams.Type"}},e._l(e.assignTypes,function(e){return a("el-option",{key:e.Value,attrs:{label:e.Name,value:e.Value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"端口",prop:"Port"}},[a("el-input",{attrs:{type:"number",min:"0",max:"65535",oninput:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.createParams.Port,callback:function(t){e.$set(e.createParams,"Port",e._n(t))},expression:"createParams.Port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"节点配置",prop:"ConfigId"}},[a("el-select",{staticClass:"el-select",attrs:{placeholder:"请选择"},on:{"visible-change":e.fetchConfigList},model:{value:e.createParams.ConfigId,callback:function(t){e.$set(e.createParams,"ConfigId",t)},expression:"createParams.ConfigId"}},e._l(e.configList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"启动配置",prop:"AnsibleConfigId"}},[a("ansibleConfigSelection",{attrs:{ansibleConfigId:e.createParams.AnsibleConfigId},on:{"update:ansibleConfigId":function(t){return e.$set(e.createParams,"AnsibleConfigId",t)},"update:ansible-config-id":function(t){return e.$set(e.createParams,"AnsibleConfigId",t)}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"选择机器",prop:"SelectedMachines"}},[a("machineSelection",{ref:"MachineSelection",attrs:{selectedMachines:e.createParams.SelectedMachines},on:{"update:selectedMachines":function(t){return e.$set(e.createParams,"SelectedMachines",t)},"update:selected-machines":function(t){return e.$set(e.createParams,"SelectedMachines",t)}}})],1),e._v(" "),a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"330px"},attrs:{type:"primary"},on:{click:e.createNodes}},[e._v("\n          创建\n        ")])],1)],1)],1)],1)},_=[],y=a("ad8f"),w=a("c48b"),I=a("121a"),T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-cascader",{staticClass:"el-select",attrs:{"show-all-levels":!1,placeholder:"请选择",options:e.machineOptions,props:e.cascaderProps,loading:e.listMachineLoading},on:{change:e.onSelectionChange,"visible-change":e.handleMachineCascaderVisibleChange},model:{value:e.internalSelectedMachines,callback:function(t){e.internalSelectedMachines=t},expression:"internalSelectedMachines"}})],1)},O=[],C=a("2fea"),L={name:"MachineSelection",props:{selectedMachines:{},multipleSelection:{type:Boolean,default:!0}},data:function(){return{cascaderProps:{multiple:this.multipleSelection,emitPath:!1},machineOptions:void 0,internalSelectedMachines:this.selectedMachines,listMachineLoading:!1}},watch:{selectedMachines:function(e){this.internalSelectedMachines=e}},created:function(){this.fetchMachineOptions()},methods:{fetchMachineOptions:function(){var e=this;this.listMachineLoading=!0,Object(C["c"])().then(function(t){e.machineOptions=[];var a=t.Data.Items;a.forEach(function(t){var a={value:t.Id,label:t.Name,children:[]};t.Machines.forEach(function(e){var t={value:e.Ip,label:e.Ip};a.children.push(t)}),a.children.length>0&&e.machineOptions.push(a)})}).finally(function(){e.listMachineLoading=!1})},handleMachineCascaderVisibleChange:function(e){e&&this.fetchMachineOptions()},onSelectionChange:function(e){this.$emit("update:selectedMachines",this.internalSelectedMachines)}}},D=L,P=Object(p["a"])(D,T,O,!1,null,null,null),x=P.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-select",{staticClass:"el-select",attrs:{loading:e.listAnsibleConfigLoading,placeholder:"请选择"},on:{"visible-change":e.fetchAnsibleConfigList,change:e.onConfigIdChange},model:{value:e.internalAnsibleConfigId,callback:function(t){e.internalAnsibleConfigId=t},expression:"internalAnsibleConfigId"}},e._l(e.ansibleConfigList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Id}})}),1)],1)},A=[],j=a("71c2"),M={name:"AnsbileConfigSelection",props:{ansibleConfigId:{type:Number,default:void 0}},watch:{ansibleConfigId:function(e){this.internalAnsibleConfigId=e}},data:function(){return{ansibleConfigList:void 0,internalAnsibleConfigId:this.ansibleConfigId,listAnsibleConfigLoading:!1}},created:function(){this.fetchAnsibleConfigList()},methods:{fetchAnsibleConfigList:function(){var e=this;this.listAnsibleConfigLoading=!0,Object(j["c"])().then(function(t){e.ansibleConfigList=t.Data.Items}).finally(function(){e.listAnsibleConfigLoading=!1})},onConfigIdChange:function(e){console.log(e),this.$emit("update:ansibleConfigId",this.internalAnsibleConfigId)}}},$=M,E=Object(p["a"])($,k,A,!1,null,null,null),F=E.exports,B={name:"BatchCreate",directives:{waves:o["waves"]},components:{machineSelection:x,ansibleConfigSelection:F},props:{configList:{type:Array,default:function(){return[]}},groupId:{type:Number},nodeList:{type:Array,default:function(){return[]}}},data:function(){return{assignTypes:[{Name:"ShardSize",Value:1},{Name:"ShardKps",Value:2},{Name:"ShardNum",Value:3}],listTableParams:{Page:void 0,Limit:void 0,DatabaseId:void 0},listDBLoading:!0,listTableLoading:!0,databaseList:null,tableList:null,createParams:{DatabaseName:"",TableName:"",Type:void 0,Port:void 0,ConfigId:void 0,AnsibleConfigId:void 0,SelectedMachines:[]},currentMaxNodeId:0,batchCreateParams:{Nodes:[]},rules:{DatabaseName:[{required:!0,message:"数据库名称是必填项"}],TableName:[{required:!0,message:"数据表名称是必填项"}],Type:[{required:!0,message:"分配类型是必填项"}],Port:[{required:!0,message:"必填项不能为空",trigger:"blur"},{type:"number",message:"请输入数字格式",trigger:"blur"},{validator:v["g"],trigger:"blur"}],ConfigId:[{required:!0,message:"必选项不能为空"}],SelectedMachines:[{required:!0,message:"必选项不能为空"}],AnsibleConfigId:[{required:!0,message:"必选项不能为空"}]}}},watch:{nodeList:function(e){var t=0;e.forEach(function(e){e.NodeId>t&&(t=e.NodeId)}),this.currentMaxNodeId=t}},created:function(){},methods:{fetchDatabase:function(){var e=this;this.listDBLoading=!0,Object(w["c"])().then(function(t){e.databaseList=t.Data.Items,e.listDBLoading=!1})},fetchDataTable:function(){var e=this;this.listTableLoading=!0,Object(y["d"])(this.listTableParams).then(function(t){e.tableList=t.Data.Items,e.listTableLoading=!1})},getDatabaseIdByName:function(e){for(var t=0;t<this.databaseList.length;++t)if(e==this.databaseList[t].Name){this.listTableParams.DatabaseId=this.databaseList[t].Id;break}},createNodes:function(){var e=this;this.$refs["dataForm"].validate(function(t){if(t){var a={DatabaseName:e.createParams.DatabaseName,TableName:e.createParams.TableName,Type:e.createParams.Type,AssignedListNum:e.createParams.SelectedMachines.length};Object(I["a"])(a).then(function(t){var a=new Array;e.createParams.SelectedMachines.forEach(function(e){a.push(e)}),a.sort(function(e,t){return e<t?-1:e>t?1:0});var n=e.currentMaxNodeId+1,s=0;t.Data.AssignedShardListInfos.forEach(function(t){var i=Object(N["c"])();i.NodeId=n++,i.Active=1,i.Host=a[s++],i.Port=e.createParams.Port,i.IsEdgeNode=!0,i.GroupId=e.groupId,i.ConfigId=e.createParams.ConfigId,i.AnsibleConfigId=e.createParams.AnsibleConfigId,i.FollowerShardList=String(t.ShardList),e.batchCreateParams.Nodes.push(i)}),Object(i["c"])(e.batchCreateParams).then(function(t){e.$notify({title:"Success",message:"Created Successfully",type:"success",duration:2e3})}).finally(function(t){if(e.batchCreateParams.Nodes=[],void 0!==t)throw t})}).finally(function(t){if(e.$emit("postCreate"),void 0!==t)throw t})}})},fetchConfigList:function(e){this.$emit("getConfig",e)}}},V=B,H=(a("f57a"),Object(p["a"])(V,S,_,!1,null,null,null)),R=H.exports,G=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-left":"10px"}},[a("el-row",{attrs:{gutter:20}},[a("el-button",{attrs:{type:"success",icon:"el-icon-video-play",disabled:e.shouldBeDisabled(e.operations.enable.Name),loading:e.shouldBeLoading(e.operations.enable.Name)},on:{click:e.enable}},[e._v("启用\n    ")]),e._v(" "),a("el-button",{attrs:{type:"warning",icon:"el-icon-video-pause",disabled:e.shouldBeDisabled(e.operations.disable.Name),loading:e.shouldBeLoading(e.operations.disable.Name)},on:{click:e.disable}},[e._v("停用\n    ")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-s-promotion",disabled:e.shouldBeDisabled(e.operations.start.Name),loading:e.shouldBeLoading(e.operations.start.Name)},on:{click:e.start}},[e._v("启动\n    ")]),e._v(" "),a("el-button",{attrs:{type:"warning",icon:"el-icon-switch-button",disabled:e.shouldBeDisabled(e.operations.stop.Name),loading:e.shouldBeLoading(e.operations.stop.Name)},on:{click:e.stop}},[e._v("停止\n    ")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh-right",disabled:e.shouldBeDisabled(e.operations.restart.Name),loading:e.shouldBeLoading(e.operations.restart.Name)},on:{click:e.restart}},[e._v("重启\n    ")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:e.shouldBeDisabled(e.operations.batchDelete.Name),loading:e.shouldBeLoading(e.operations.batchDelete.Name)},on:{click:e.batchDelete}},[e._v("删除\n    ")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",disabled:e.shouldBeDisabled(e.operations.upgrade.Name),loading:e.shouldBeLoading(e.operations.upgrade.Name)},on:{click:e.upgrade}},[e._v("更新\n    ")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-monitor"},on:{click:e.handleConsole}},[e._v("控制台")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",disabled:e.shouldBeDisabled(e.operations.batchAdd.Name),loading:e.shouldBeLoading(e.operations.batchAdd.Name)},on:{click:function(t){return e.$emit("handleBatchCreate")}}},[e._v("\n      批量添加边缘节点\n    ")]),e._v(" "),a("el-dropdown",{on:{command:function(t){return e.changeRole(t)}}},[a("el-button",{attrs:{type:"primary",disabled:e.shouldBeDisabled(e.operations.changeRole.Name),loading:e.shouldBeLoading(e.operations.changeRole.Name)}},[e._v("\n        角色设置"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:e.roles.Master}},[e._v("当前组设为主副本")]),e._v(" "),a("el-dropdown-item",{attrs:{command:e.roles.Follower}},[e._v("当前组设为从副本")])],1)],1),e._v(" "),a("el-checkbox",{staticClass:"filter-item",staticStyle:{"margin-left":"15px"},on:{change:function(t){return e.$emit("handleEnableBatchOperation",t)}}},[e._v("\n      批量操作\n    ")]),e._v(" "),0!==e.nodesToOperateOn.size?a("el-tag",{attrs:{size:"small"}},[e._v("选中 "+e._s(e.nodesToOperateOn.size)+" 项")]):e._e()],1),e._v(" "),a("el-dialog",{ref:"consoleDialog",attrs:{title:"控制台",visible:e.consoleDialogVisible,width:"100%"},on:{"update:visible":function(t){e.consoleDialogVisible=t}}},[a("div",{staticClass:"console",domProps:{innerHTML:e._s(e.html)}})])],1)},q=[],z=(a("a481"),a("1386")),K=a.n(z),U=a("5c96"),W=a("1682"),J={name:"AnsibleOperation",props:{nodesToOperateOn:{type:Map,default:function(){return new Map}},groupName:{type:String,default:""},groupId:{type:Number},operations:{type:Object,default:function(){return{}}}},data:function(){return{ansibleOperationParams:{Nodes:[],AnsibleVars:{},Tags:"",Roles:[],OperationName:""},userAbortMessage:"user abort",ansi:void 0,qureyOperationInfoParams:{GroupName:this.groupName},timeoutId:void 0,consoleContent:"",consoleDialogVisible:!1,consoleDialogLoading:void 0,operationInProgress:!1,currentOperationName:"",queryAnsibleConfigParams:{Page:void 0,Limit:void 0,Id:void 0},roles:{Master:"master",Follower:"follower"},changeRoleParams:{Id:void 0,GroupId:this.groupId,Master:!1}}},computed:{html:function(){return this.ansi.ansi_to_html(this.consoleContent).replace(/\n/gm,"<br>")},showConsoleDialogLoading:function(){return this.operationInProgress&&0===this.consoleContent.length}},watch:{showConsoleDialogLoading:function(e){!0===e?this.createConsoleDialogLoading():this.consoleDialogLoading.close()}},beforeMount:function(){this.ansi=new K.a},created:function(){this.getOperationInfo()},updated:function(){this.$el.scrollTop=this.$el.scrollHeight},methods:{shouldBeDisabled:function(e){return e!==this.currentOperationName&&!0===this.operationInProgress},shouldBeLoading:function(e){return e===this.currentOperationName&&!0===this.operationInProgress},enable:function(){this.ansibleOperation(this.operations.enable)},disable:function(){this.ansibleOperation(this.operations.disable)},start:function(){this.ansibleOperation(this.operations.start)},stop:function(){var e=this;this.checkNodeCanStop().then(function(){e.ansibleOperation(e.operations.stop)}).catch(function(t){if(t.message!==e.userAbortMessage)throw t})},restart:function(){var e=this;this.checkNodeCanStop().then(function(){e.ansibleOperation(e.operations.restart)}).catch(function(t){if(t.message!==e.userAbortMessage)throw t})},upgrade:function(){var e=this;this.checkNodeCanStop().then(function(){e.ansibleOperation(e.operations.upgrade)}).catch(function(t){if(t.message!==e.userAbortMessage)throw t})},batchDelete:function(){this.checkParams()&&this.$emit("batchDeleteNodes")},changeRole:function(e){var t=this;this.changeRoleParams.Master=!1,this.roles.Master===e&&(this.changeRoleParams.Master=!0),this.checkGroupReadyToBeMaster(this.changeRoleParams.Master).then(function(){t.operationInProgress=!0,t.currentOperationName=t.operations.changeRole.Name,Object(i["d"])(t.changeRoleParams).then(function(e){t.$notify({title:"Success",message:"Role change Successfully",type:"success",duration:2e3})}).finally(function(){t.operationInProgress=!1})}).catch(function(e){if(e.message!==t.userAbortMessage)throw e})},checkParams:function(){return 0!==this.nodesToOperateOn.size||(Object(U["Message"])({showClose:!0,message:"当前没有选中的节点，请选择要操作的节点",type:"warning",center:!0,duration:2e3}),!1)},checkNodeCanStop:function(){var e=this;return new Promise(function(t,a){var n="<p><strong>以下节点 KPS 不为0，仍要继续操作？</strong></p>",s=0;e.nodesToOperateOn.forEach(function(e,t,a){if(0!==e.ReadKps||0!==e.WriteKps){var i=e.Host+":"+e.Port,o="WriteKps: "+e.WriteKps+" ReadKps: "+e.ReadKps;n+="<p>"+i+"--"+o+"</p>",++s}}),0!==s?e.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(function(){t()}).catch(function(){a(new Error(e.userAbortMessage)),e.$emit("postAnsibleOperation")}):t()})},checkAnsibleConfigs:function(){var e=this;return new Promise(function(t,a){var n="",s=new Set,i=!1;e.nodesToOperateOn.forEach(function(e,t,a){0!==e.AnsibleConfigId?s.add(e.AnsibleConfigId):i=!0;var o=e.Host+":"+e.Port;n+="<p>"+o+"--"+e.AnsibleConfigName+"</p>"});var o=!1,r="";1===s.size&&!1===i?(e.queryAnsibleConfigParams.Id=s.values().next().value,t()):0===s.size||!0===i?(o=!0,r="<p><strong>选择的节点没有设置启动参数，请为节点设置启动参数！</strong></p>"):s.size>1&&(o=!0,r="<p><strong>选择的节点启动参数不一致，不可以同时执行操作！</strong></p>"),!0===o&&(r+=n,e.$alert(r,"提示",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0,type:"warning"}).then(function(){a(new Error(e.userAbortMessage)),e.$emit("postAnsibleOperation")}))})},checkGroupReadyToBeMaster:function(e){if(!0===e){var t=this;return new Promise(function(e,a){var n={GroupName:t.groupName};Object(W["a"])(n).then(function(n){var s=n.Data;if(!0===s.Ready)e();else{var i=function(e,t){return e-t},o="<p><strong>当前组无法切换为主副本！</strong></p>";if(0!==s.MissingShards.length&&(s.MissingShards=s.MissingShards.sort(i),o+="<p><strong> 缺少分片：</strong>"+String(s.MissingShards)+"</p>"),0!==s.ReduplicativeShards.length&&(s.ReduplicativeShards=s.ReduplicativeShards.sort(i),o+="<p><strong> 重复分片：</strong>"+String(s.ReduplicativeShards)+"</p>"),0!==Object.keys(s.UnavailableShards).length)for(var r in o+="<p><strong> Unavailable 分片：</strong></p>",s.UnavailableShards){var l=s.UnavailableShards[r].sort(i);o+="<p> NodeId: "+r+" Shards: "+String(l)+"</p>"}if(0!==s.InconsistentNodes.length){var c=s.InconsistentNodes.sort(i);o+="<p><strong> 节点分片列表与 Server 不一致, 节点 ID：</strong>"+String(c)+"</p>"}t.$alert(o,"提示",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0,type:"warning"}).then(function(){a(new Error(t.userAbortMessage))})}})})}return new Promise(function(e,t){e()})},ansibleOperation:function(e){var t=this;this.checkParams()?this.checkAnsibleConfigs().then(function(){t.consoleDialogVisible=!0,t.operationInProgress=!0,t.currentOperationName=e.Name,t.ansibleOperationParams.OperationName=e.Name,t.ansibleOperationParams.Tags=e.Tags,t.ansibleOperationParams.Nodes=[],t.nodesToOperateOn.forEach(function(e,a,n){var s={Host:e.Host,Port:e.Port,NodeId:e.NodeId,GroupName:e.GroupName,Dc:e.Dc};t.ansibleOperationParams.Nodes.push(s)}),Object(j["c"])(t.queryAnsibleConfigParams).then(function(e){var a=e.Data.Items[0].Roles,n=e.Data.Items[0].Vars;t.ansibleOperationParams.Roles=[],a.split(",").forEach(function(e){t.ansibleOperationParams.Roles.push(e.trim())});var s=JSON.parse(n),o={};s.forEach(function(e){o[e.Name]=e.Value}),t.ansibleOperationParams.AnsibleVars=o,Object(i["a"])(t.ansibleOperationParams).then(function(e){t.getOperationInfo()}).catch(function(e){throw t.operationInProgress=!1,e}).finally(function(){t.$emit("postAnsibleOperation")})})}).catch(function(e){if(e.message!==t.userAbortMessage)throw e}):this.$emit("postAnsibleOperation")},getOperationInfo:function(){var e=this;Object(i["f"])(this.qureyOperationInfoParams).then(function(t){e.consoleContent=t.Data.Log,!0===t.Data.HasTask?!0===t.Data.Done?(e.operationInProgress=!1,clearTimeout(e.timeoutId)):!1===e.operationInProgress&&(e.operationInProgress=!0,e.currentOperationName=t.Data.OperationName):clearTimeout(e.timeoutId)}).catch(function(e){console.log(e)}),this.timeoutId=setTimeout(this.getOperationInfo,1e3)},handleConsole:function(){this.consoleDialogVisible=!0,!1===this.operationInProgress&&this.getOperationInfo()},createConsoleDialogLoading:function(){this.consoleDialogLoading=U["Loading"].service({text:"加载中……",target:this.$refs.consoleDialog.$el.querySelector(".el-dialog")})}}},X=J,Y=(a("a9b1"),Object(p["a"])(X,G,q,!1,null,"cd544726",null)),Q=Y.exports,Z={directives:{waves:o["waves"]},components:{shardView:m,batchCreate:R,ansibleOperation:Q,machineSelection:x,ansibleConfigSelection:F},props:{nodeList:{type:Array,default:function(){return[]}},shards:{type:Object,default:function(){return{}}},relations:{type:Object,default:function(){return{}}},shardList:{type:Object,default:function(){return{}}},groupName:{type:String},groupId:{type:Number}},filters:{cardStyle:function(e){return 1!==e.Active?"background:#adabab":1!==e.Status?"background:#e6ab5d":"background:#ffffff"},cardHeader:function(e){return!1===e.IsAvailable?"color:#df912f":"color:#000000"}},data:function(){return{dialogShardsVisible:!1,currentNodeShards:[],dialogFormVisible:!1,dialogBatchCreateVisible:!1,textMap:{create:"新增节点",update:"",batchCreate:"批量添加边缘节点"},dialogStatus:"create",statusText:{0:"禁用",1:"启用"},yesNoText:{0:"否",1:"是"},temp:Object(N["c"])(),tempLeaderShards:"",tempFollowerShards:"",tempEdgeNodeFollowerShards:{ShardsList:[]},TablelistParams:{Page:1,Limit:0,DatabaseName:"",TableName:""},tableList:[],tableOption:[],selectTable:{nodeSelectedTable:[],nodeSelectedTableShards:""},addNewTableFlag:!1,listGroupLoading:!1,groupList:[],groupListParams:{ShowDetails:!0},listConfigLoading:!1,configList:[],nodeDeleteParams:{Id:0},enableBatchOperation:!1,selectedNodes:new Object,nodesToOperateOn:new Map,batchDeleteNodeParams:{Ids:[]},operations:{start:{Name:"start",Tags:"start"},stop:{Name:"stop",Tags:"stop"},enable:{Name:"enable",Tags:"enable"},disable:{Name:"disable",Tags:"disable"},restart:{Name:"restart",Tags:"restart"},upgrade:{Name:"upgrade",Tags:"upgrade"},delete:{Name:"delete",Tags:"delete"},add:{Name:"add",Tags:"add"},batchDelete:{Name:"batchDelete",Tags:"batchDelete"},batchAdd:{Name:"batchAdd",Tags:"batchAdd"},changeRole:{Name:"changeRole",Tags:"changeRole"}},selectedMachines:[],rules:{GroupName:[{required:!0,message:"必选项不能为空",trigger:"blur"}],NodeId:[{required:!0,message:"必填项不能为空",trigger:"blur"}],Host:[{required:!0,message:"必填项不能为空",trigger:"blur"},{validator:v["f"],trigger:"blur"}],Port:[{required:!0,message:"必填项不能为空",trigger:"blur"},{type:"number",message:"请输入数字格式",trigger:"blur"},{validator:v["g"],trigger:"blur"}],Weight:[{required:!0,message:"必填项不能为空"}],ConfigName:[{required:!0,message:"必选项不能为空"}],AnsibleConfigId:[{required:!0,message:"必选项不能为空"}]},followerShardListRules:{Shards:[{required:!0,message:"必选项不能为空",trigger:"blur"}]},SelectTableRules:{nodeSelectedTable:[{type:"array",required:!0,message:"请选择数据表",trigger:"blur"}],nodeSelectedTableShards:[{required:!0,message:"必选项不能为空",trigger:"blur"}]}}},methods:{shardHandler:function(e){var t=this;if(this.currentNodeShards=[],"undefined"===typeof this.shardList[this.groupName][e])return!1;var a=this.shardList[this.groupName][e];a.forEach(function(e){if("undefined"===typeof t.shards[e])return!1;var a=t.shards[e],n=t.relations[a.shardId],s=[];n.leader!==e&&s.push(t.shards[n.leader]),n.follower.forEach(function(a){if(a===e)return!1;s.push(t.shards[a])}),a["relations"]=s,t.currentNodeShards.push(a),t.currentNodeShards.sort(function(e,t){return e.shardId-t.shardId})})},handleShowDetail:function(e){this.temp=e,this.dialogStatus="update",this.updateTempShardsStruct(),this.shardHandler(this.temp.NodeId),this.dialogShardsVisible=!0,this.dialogFormVisible=!0},handleCreate:function(){var e=this;this.temp=Object(N["c"])(),this.clearTempShards(),this.dialogShardsVisible=!1,this.dialogFormVisible=!0,this.dialogStatus="create",this.$nextTick(function(){e.$refs["dataForm"].clearValidate()})},handleAddNewTable:function(e){e?this.addNewTableToNode():this.addNewTableFlag=!0},handleBatchCreate:function(){this.dialogStatus="batchCreate",this.dialogBatchCreateVisible=!0},postBatchCreate:function(){this.dialogBatchCreateVisible=!1},stringfyNonEdgeNodeShards:function(e){var t={ShardsList:[]};return t.ShardsList.push({Table:"default",Shards:e}),JSON.stringify(t)},formatTempShardList:function(){this.temp.IsEdgeNode?this.temp.FollowerShardList=JSON.stringify(this.tempEdgeNodeFollowerShards):(this.temp.LeaderShardList=this.stringfyNonEdgeNodeShards(this.tempLeaderShards),this.temp.FollowerShardList=this.stringfyNonEdgeNodeShards(this.tempFollowerShards))},edgeNodeAddNewTableAndValidateShards:function(){if(this.tempEdgeNodeFollowerShards.ShardsList.length>0){var e=!1;if(this.$refs["followerShardListForm"].validate(function(t){e=!!t}),!e)return!1}if(this.addNewTableFlag){var t=this.addNewTableToNode();if(!t)return!1;this.addNewTableFlag=!1}return!0},createNode:function(){var e=this;if(this.temp.IsEdgeNode){var t=this.edgeNodeAddNewTableAndValidateShards();if(!t)return}this.$refs["dataForm"].validate(function(t){t&&(e.formatTempShardList(),Object(i["i"])(e.temp).then(function(t){e.$notify({title:"Success",message:"Created Successfully",type:"success",duration:2e3})}),e.dialogFormVisible=!1)})},updateNode:function(){var e=this;if(this.temp.IsEdgeNode){var t=this.edgeNodeAddNewTableAndValidateShards();if(!t)return}this.$refs["dataForm"].validate(function(t){t&&(e.formatTempShardList(),Object(i["j"])(e.temp).then(function(t){e.$notify({title:"Success",message:"Update Successfully",type:"success",duration:2e3})}),e.dialogFormVisible=!1)})},deleteNode:function(e){var t=this;this.$confirm("确认要删除该节点？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$refs.AnsibleOperation.checkNodeCanStop().then(function(){t.nodeDeleteParams.Id=e.Id,Object(i["e"])(t.nodeDeleteParams).then(function(e){t.$notify({title:"Success",message:"Delete Successfully",type:"success",duration:2e3}),t.removeCheckedNode(t.nodeDeleteParams.Id)})}).catch(function(e){if(e.message!==t.$refs.AnsibleOperation.userAbortMessage)throw e})}).catch(function(){})},batchDeleteNodes:function(){var e=this;this.$confirm("确认要删除选中的节点？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$refs.AnsibleOperation.checkNodeCanStop().then(function(){e.batchDeleteNodeParams.Ids=[],Object.keys(e.selectedNodes).forEach(function(t){e.batchDeleteNodeParams.Ids.push(parseInt(t))}),Object(i["b"])(e.batchDeleteNodeParams).then(function(t){e.$notify({title:"Success",message:"Delete Successfully",type:"success",duration:2e3}),e.batchDeleteNodeParams.Ids.forEach(function(t){e.removeCheckedNode(t)})})}).catch(function(t){if(t.message!==e.$refs.AnsibleOperation.userAbortMessage)throw t})}).catch(function(){})},fetchGroupList:function(e){var t=this;e&&(this.listGroupLoading=!0,Object(b["c"])(this.groupListParams).then(function(e){t.groupList=e.Data.Items}).finally(function(){t.listGroupLoading=!1}))},getGroupIdByName:function(e){for(var t=0;t<this.groupList.length;++t)if(e===this.groupList[t].Name){this.temp.GroupId=this.groupList[t].Id,0!==this.groupList[t].NodeConfigId&&0===this.temp.ConfigId&&(this.temp.ConfigId=this.groupList[t].NodeConfigId,this.temp.ConfigName=this.groupList[t].NodeConfigName);break}},fetchConfigList:function(e){var t=this;e&&(this.listConfigLoading=!0,Object(g["c"])().then(function(e){t.configList=e.Data.Items}).finally(function(){t.listConfigLoading=!1}))},getConfigIdByName:function(e){for(var t=0;t<this.configList.length;++t)if(e===this.configList[t].Name){this.temp.ConfigId=this.configList[t].Id;break}},roleChanged:function(e){e&&(this.temp.IsEdgeNode=!1)},clearTempShards:function(){this.tempLeaderShards="",this.tempFollowerShards="",this.tempEdgeNodeFollowerShards.ShardsList=[],this.selectTable.nodeSelectedTable=[],this.selectTable.nodeSelectedTableShards="",this.addNewTableFlag=!1},parseShardsForNonEdgeNodeShards:function(e){var t={ShardsList:[]};try{return t=JSON.parse(e),t.ShardsList[0].Shards}catch(a){return e}},updateTempShardsStruct:function(){if(this.clearTempShards(),this.temp.IsEdgeNode){if(""===this.temp.FollowerShardList)return;try{this.tempEdgeNodeFollowerShards=JSON.parse(this.temp.FollowerShardList)}catch(e){this.$set(this.tempEdgeNodeFollowerShards.ShardsList,"0",{Table:"default",Shards:this.temp.FollowerShardList})}}else this.tempLeaderShards=this.parseShardsForNonEdgeNodeShards(this.temp.LeaderShardList),this.tempFollowerShards=this.parseShardsForNonEdgeNodeShards(this.temp.FollowerShardList)},removeDuplicatedShards:function(e){var t=[];return e.split(",").forEach(function(e){t.push(e.trim())}),String(Array.from(new Set(t)))},removeDuplicateLeaderShards:function(){this.tempLeaderShards=this.removeDuplicatedShards(this.tempLeaderShards)},removeDuplicateFollowerShards:function(){if(this.temp.IsEdgeNode)for(var e=0;e<this.tempEdgeNodeFollowerShards.ShardsList.length;e++)this.tempEdgeNodeFollowerShards.ShardsList[e]["Shards"]=this.removeDuplicatedShards(this.tempEdgeNodeFollowerShards.ShardsList[e]["Shards"]);else this.tempFollowerShards=this.removeDuplicatedShards(this.tempFollowerShards)},removeSelectedTableFollowerDuplicateShards:function(){this.selectTable.nodeSelectedTableShards=this.removeDuplicatedShards(this.selectTable.nodeSelectedTableShards)},handleEnableBatchOperation:function(e){this.enableBatchOperation=e,this.selectedNodes={}},onNodeChecked:function(e,t){var a=t.Id;e?this.$set(this.selectedNodes,a,t):this.$delete(this.selectedNodes,a)},removeCheckedNode:function(e){this.$delete(this.selectedNodes,e)},handleNodeCommand:function(e,t){switch(this.nodesToOperateOn.clear(),this.nodesToOperateOn.set(t.Id,t),e){case this.operations.enable.Name:this.$refs.AnsibleOperation.enable();break;case this.operations.disable.Name:this.$refs.AnsibleOperation.disable();break;case this.operations.start.Name:this.$refs.AnsibleOperation.start();break;case this.operations.stop.Name:this.$refs.AnsibleOperation.stop();break;case this.operations.restart.Name:this.$refs.AnsibleOperation.restart();break;case this.operations.upgrade.Name:this.$refs.AnsibleOperation.upgrade();break;case this.operations.delete.Name:this.deleteNode(t);break}},postAnsibleOperation:function(){this.nodesToOperateOn=new Map(Object.entries(this.selectedNodes))},fetchTableList:function(){var e=this;Object(y["d"])(this.TablelistParams).then(function(t){e.tableList=t.Data.Items,e.tableOption=[];var a=[];e.tableList.forEach(function(e){a.push(e.DatabaseName)}),a=Array.from(new Set(a)),a.forEach(function(t){var a={value:t,label:t,children:[]};e.tableOption.push(a)}),e.tableList.forEach(function(t){for(var a=0;a<e.tableOption.length;a++)if(t.DatabaseName===e.tableOption[a].value){var n={value:t.Name,label:t.Name};e.tableOption[a].children.push(n)}})})},judgeTableExists:function(){var e=this.selectTable.nodeSelectedTable[0]+":"+this.selectTable.nodeSelectedTable[1];return this.tempEdgeNodeFollowerShards.ShardsList.some(function(t){if(t.Table===e)return!0})},addNewTableToNode:function(){var e=!1;return this.$refs["selectTableForm"].validate(function(t){e=!!t}),!!e&&(!0===this.judgeTableExists()?(this.$message({message:"该表的分片信息已存在，请直接修改或重新添加!!",type:"error"}),!1):(this.tempEdgeNodeFollowerShards.ShardsList.push({Table:this.selectTable.nodeSelectedTable[0]+":"+this.selectTable.nodeSelectedTable[1],Shards:this.selectTable.nodeSelectedTableShards}),this.removeDuplicateFollowerShards(),this.selectTable.nodeSelectedTable=[],this.selectTable.nodeSelectedTableShards="",!0))},handleDeleteTable:function(e){for(var t=0;t<this.tempEdgeNodeFollowerShards.ShardsList.length;t++)if(e.Table===this.tempEdgeNodeFollowerShards.ShardsList[t].Table)return this.tempEdgeNodeFollowerShards.ShardsList.splice(t,1),void this.removeDuplicateFollowerShards()},handelDeleteSelectedTable:function(){this.addNewTableFlag=!1,this.selectTable.nodeSelectedTable=[],this.selectTable.nodeSelectedTableShards=""}},watch:{shardList:function(e){this.dialogShardsVisible&&this.dialogFormVisible&&this.shardHandler(this.temp.NodeId)},shards:function(e){this.dialogShardsVisible&&this.dialogFormVisible&&this.shardHandler(this.temp.NodeId)},relations:function(e){this.dialogShardsVisible&&this.dialogFormVisible&&this.shardHandler(this.temp.NodeId)},nodeList:function(e){var t=this;e.forEach(function(e){e.Id in t.selectedNodes&&(t.selectedNodes[e.Id]=e)})},selectedNodes:{handler:function(e){this.nodesToOperateOn=new Map(Object.entries(e))},deep:!0}}},ee=Z,te=(a("6441"),Object(p["a"])(ee,r,l,!1,null,null,null)),ae=te.exports,ne={components:{nodeView:ae},directives:{waves:o["waves"]},data:function(){return{activeName:"empty",list:[],shardData:{},shards:{},relations:{},nodeTimeoutId:void 0,shardTimeoutId:void 0,filterParams:{tableName:"",enable:!1}}},created:function(){this.fetchNodeList(),this.fetchShardList()},beforeDestroy:function(){clearTimeout(this.nodeTimeoutId),clearTimeout(this.shardTimeoutId)},methods:{fetchNodeListOnce:function(){var e=this;Object(i["g"])().then(function(t){e.list=t.Data,e.filterParams.enable&&e.list.forEach(function(t){t.Nodes=t.Nodes.filter(function(t){if(t.Desc.includes(e.filterParams.tableName))return t})}),e.list.forEach(function(e){e.Nodes=e.Nodes.sort(function(e,t){return e.NodeId-t.NodeId})}),e.list.length>0&&"empty"===e.activeName&&(e.activeName=e.list[0].GroupName)})},fetchNodeList:function(){this.fetchNodeListOnce(),this.nodeTimeoutId=setTimeout(this.fetchNodeList,3e3)},fetchShardList:function(){var e=this;Object(i["h"])().then(function(t){e.shardData=t.Data.groupShards,e.shards=t.Data.shards,e.relations=t.Data.relations}),this.shardTimeoutId=setTimeout(this.fetchShardList,15e3)}}},se=ne,ie=Object(p["a"])(se,n,s,!1,null,null,null);t["default"]=ie.exports},6441:function(e,t,a){"use strict";var n=a("15e2"),s=a.n(n);s.a},6724:function(e,t,a){"use strict";a("8d41");var n="@@wavesContext";function s(e,t){function a(a){var n=Object.assign({},t.value),s=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),i=s.ele;if(i){i.style.position="relative",i.style.overflow="hidden";var o=i.getBoundingClientRect(),r=i.querySelector(".waves-ripple");switch(r?r.className="waves-ripple":(r=document.createElement("span"),r.className="waves-ripple",r.style.height=r.style.width=Math.max(o.width,o.height)+"px",i.appendChild(r)),s.type){case"center":r.style.top=o.height/2-r.offsetHeight/2+"px",r.style.left=o.width/2-r.offsetWidth/2+"px";break;default:r.style.top=(a.pageY-o.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",r.style.left=(a.pageX-o.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return r.style.backgroundColor=s.color,r.className="waves-ripple z-active",!1}}return e[n]?e[n].removeHandle=a:e[n]={removeHandle:a},a}var i={bind:function(e,t){e.addEventListener("click",s(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[n].removeHandle,!1),e.addEventListener("click",s(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[n].removeHandle,!1),e[n]=null,delete e[n]}},o=function(e){e.directive("waves",i)};window.Vue&&(window.waves=i,Vue.use(o)),i.install=o},"680a":function(e,t,a){"use strict";var n=a("a53a"),s=a.n(n);s.a},"71c2":function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"b",function(){return r});var n=a("b775");function s(e){return Object(n["a"])({url:"/ansible_config/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/ansible_config/store",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/ansible_config/update",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/ansible_config/delete",method:"post",data:e})}},"8d41":function(e,t,a){},a53a:function(e,t,a){},a9b1:function(e,t,a){"use strict";var n=a("322e"),s=a.n(n);s.a},ad8f:function(e,t,a){"use strict";a.d(t,"d",function(){return s}),a.d(t,"e",function(){return i}),a.d(t,"a",function(){return o}),a.d(t,"g",function(){return r}),a.d(t,"b",function(){return l}),a.d(t,"f",function(){return c}),a.d(t,"c",function(){return d});var n=a("b775");function s(e){return Object(n["a"])({url:"/table/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/table/list_detail",method:"get",params:e})}function o(e){return Object(n["a"])({url:"/table/store",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/table/update",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/table/delete",method:"post",data:e})}function c(){return Object(n["a"])({url:"table/synchronize",method:"post"})}function d(){return Object(n["a"])({url:"/table/list_commands",method:"get"})}},c48b:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"b",function(){return r});var n=a("b775");function s(e){return Object(n["a"])({url:"/database/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:"/database/store",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/database/update",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/database/delete",method:"post",data:e})}},cf45:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"e",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"a",function(){return r}),a.d(t,"b",function(){return l});a("6b54"),a("f576"),a("28a5");var n=a("768b");function s(){return{Id:0,NodeId:void 0,Active:0,Status:1,Host:"",Port:void 0,Weight:0,Master:!1,IsEdgeNode:!1,Desc:"",GroupId:0,GroupName:"",ConfigId:0,ConfigName:"",AnsibleConfigId:void 0,AnsibleConfigName:"",LeaderShardList:"",FollowerShardList:""}}function i(e){var t=e.split(":"),a=Object(n["a"])(t,2),s=a[0];a[1];return parseInt(s)}function o(e){var t=e.toString().padStart(2,"0");return t+":00"}function r(e,t){var a=e,n=new Promise(function(e,n){var s=a.$refs[t];void 0!=s?s.validate(function(t){t?e():n()}):e()});return n}function l(e,t){e.$refs[t].clearValidate()}},f57a:function(e,t,a){"use strict";var n=a("360e"),s=a.n(n);s.a}}]);