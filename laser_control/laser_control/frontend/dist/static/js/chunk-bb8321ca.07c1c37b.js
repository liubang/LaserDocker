(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bb8321ca"],{"02a1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.createClear}},[e._v("\n      选择清库\n    ")]),e._v(" "),a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.createRollback}},[e._v("\n      选择回滚版本\n    ")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,"element-loading-text":"Loading","default-sort":{prop:"currentVersionTime",order:"descending"},border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"ID",width:"95",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{label:"Laser 数据库"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.databaseName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Laser 数据表"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.tableName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"当前版本"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.currentVersion))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"当前版本时间",prop:"currentVersionTime",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.currentVersionTime))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"90","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.showDetail(i)}}},[e._v("历史版本")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.detailDialogFormVisible},on:{"update:visible":function(t){e.detailDialogFormVisible=t}}},[a("el-table",{attrs:{data:e.detailTemp.versionInfo,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"版本"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.versionName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.versionTime))])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.clearDialogFormVisible},on:{"update:visible":function(t){e.clearDialogFormVisible=t}}},[a("el-form",{ref:"clearDataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.clearRules,model:e.formTemp,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"Laser 数据库",prop:"DatabaseName"}},[a("el-select",{attrs:{loading:e.listDBLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDatabase,change:function(t){return e.getDatabaseIdByName(e.formTemp.DatabaseName)}},model:{value:e.formTemp.DatabaseName,callback:function(t){e.$set(e.formTemp,"DatabaseName",t)},expression:"formTemp.DatabaseName"}},e._l(e.databaseList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Laser 数据表",prop:"TableName"}},[a("el-select",{attrs:{loading:e.listDTLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDataTable},model:{value:e.formTemp.TableName,callback:function(t){e.$set(e.formTemp,"TableName",t)},expression:"formTemp.TableName"}},e._l(e.dataTableList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.clearDialogFormVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.clearData()}}},[e._v("\n        提交\n      ")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.rollbackDialogFormVisible},on:{"update:visible":function(t){e.rollbackDialogFormVisible=t}}},[a("el-form",{ref:"rollbackDataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rollbackRules,model:e.formTemp,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"Laser 数据库",prop:"DatabaseName"}},[a("el-select",{attrs:{loading:e.listDBLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDatabase,change:function(t){return e.getDatabaseIdByName(e.formTemp.DatabaseName)}},model:{value:e.formTemp.DatabaseName,callback:function(t){e.$set(e.formTemp,"DatabaseName",t)},expression:"formTemp.DatabaseName"}},e._l(e.databaseList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Laser 数据表",prop:"TableName"}},[a("el-select",{attrs:{loading:e.listDTLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDataTable},model:{value:e.formTemp.TableName,callback:function(t){e.$set(e.formTemp,"TableName",t)},expression:"formTemp.TableName"}},e._l(e.dataTableList,function(e){return a("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Laser 数据版本",prop:"VersionName"}},[a("el-select",{attrs:{loading:e.listVSLoading,placeholder:"请选择"},on:{"visible-change":e.fetchDataVersion},model:{value:e.formTemp.VersionName,callback:function(t){e.$set(e.formTemp,"VersionName",t)},expression:"formTemp.VersionName"}},e._l(e.dataVersionList,function(e){return a("el-option",{key:e.versionName,attrs:{label:e.versionName,value:e.versionName}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.rollbackDialogFormVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.rollbackData()}}},[e._v("\n        提交\n      ")])],1)],1)],1)},l=[],n=a("b775");function o(e){return Object(n["a"])({url:"version_change/show",method:"get",params:e})}function r(e){return Object(n["a"])({url:"version_change/clear",method:"post",data:e})}function s(e){return Object(n["a"])({url:"version_change/version",method:"post",data:e})}function c(e){return Object(n["a"])({url:"version_change/rollback",method:"post",data:e})}var u=a("c48b"),m=a("ad8f"),d=a("6724"),f=(a("61f7"),{directives:{waves:d["waves"]},data:function(){return{list:null,listLoading:!0,detailDialogFormVisible:!1,clearDialogFormVisible:!1,rollbackDialogFormVisible:!1,textMap:{detail:"数据版本详情",clear:"选择清理数据表",rollback:"选择数据表回滚版本"},dialogStatus:null,listDBLoading:!0,listDTLoading:!0,listVSLoading:!0,databaseList:null,dataTableList:null,dataVersionList:null,detailTemp:{},formTemp:{},formQuery:{},clearRules:{DatabaseName:[{required:!0,message:"数据库名称是必填项"}],TableName:[{required:!0,message:"表名是必填项"}]},rollbackRules:{DatabaseName:[{required:!0,message:"数据库名称是必填项"}],TableName:[{required:!0,message:"表名是必填项"}],VersionName:[{required:!0,message:"表名是必填项"}]}}},created:function(){this.fetchData()},methods:{fetchData:function(){var e=this;this.listLoading=!0,o().then(function(t){e.list=t.Data,e.getDateByVersion(e.list),e.listLoading=!1})},showDetail:function(e){console.log(e),this.detailTemp=e,this.detailDialogFormVisible=!0,this.dialogStatus="detail"},resetFormTemp:function(){this.formTemp={}},createClear:function(){var e=this;this.resetFormTemp(),this.clearDialogFormVisible=!0,this.dialogStatus="clear",this.$nextTick(function(){e.$refs["clearDataForm"].clearValidate()})},clearData:function(){var e=this;this.$refs["clearDataForm"].validate(function(t){t&&(r(e.formTemp).then(function(t){e.$notify({title:"Success",message:"清空数据表成功,生成新版本号"+t.Data,type:"success",duration:3e3}),e.fetchData()}),e.clearDialogFormVisible=!1,e.$notify({title:"Success",message:"提交清空任务执行中...",type:"success",duration:2e3}))})},createRollback:function(){var e=this;this.resetFormTemp(),this.rollbackDialogFormVisible=!0,this.dialogStatus="rollback",Object(u["c"])().then(function(t){e.databaseList=t.Data.Items,e.listDBLoading=!1}),this.$nextTick(function(){e.$refs["rollbackDataForm"].clearValidate()})},rollbackData:function(){var e=this;this.$refs["rollbackDataForm"].validate(function(t){t&&(c(e.formTemp).then(function(t){e.$notify({title:"Success",message:"回滚数据表成功"+t.Data,type:"success",duration:3e3}),e.fetchData()}),e.rollbackDialogFormVisible=!1,e.$notify({title:"Success",message:"提交回滚任务执行中...",type:"success",duration:2e3}))})},fetchDatabase:function(){var e=this;this.listDBLoading=!0,Object(u["c"])().then(function(t){e.databaseList=t.Data.Items,e.listDBLoading=!1})},getDatabaseIdByName:function(e){for(var t=0;t<this.databaseList.length;++t)if(e==this.databaseList[t].Name){this.formTemp.DatabaseId=this.databaseList[t].Id,this.formQuery.DatabaseId=this.databaseList[t].Id;break}},fetchDataTable:function(){var e=this;this.listDTLoading=!0,this.isEmpty(this.formQuery.DatabaseId)||Object(m["d"])(this.formQuery).then(function(t){e.dataTableList=t.Data.Items,e.listDTLoading=!1})},fetchDataVersion:function(){var e=this;this.listVSLoading=!0,this.isEmpty(this.formTemp.DatabaseName)||this.isEmpty(this.formTemp.TableName)||s(this.formTemp).then(function(t){e.dataVersionList=t.Data,e.listVSLoading=!1})},isEmpty:function(e){return"undefined"==typeof e||null==e||""==e},getDateByVersion:function(e){var t=0,a=0;for(t=0;t<e.length;t++)for(a=0;a<e[t].versionInfo.length;a++)if(e[t].versionInfo[a].versionName===e[t].currentVersion){e[t].currentVersionTime=e[t].versionInfo[a].versionTime;break}}}}),b=f,p=a("2877"),h=Object(p["a"])(b,i,l,!1,null,null,null);t["default"]=h.exports},6724:function(e,t,a){"use strict";a("8d41");var i="@@wavesContext";function l(e,t){function a(a){var i=Object.assign({},t.value),l=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},i),n=l.ele;if(n){n.style.position="relative",n.style.overflow="hidden";var o=n.getBoundingClientRect(),r=n.querySelector(".waves-ripple");switch(r?r.className="waves-ripple":(r=document.createElement("span"),r.className="waves-ripple",r.style.height=r.style.width=Math.max(o.width,o.height)+"px",n.appendChild(r)),l.type){case"center":r.style.top=o.height/2-r.offsetHeight/2+"px",r.style.left=o.width/2-r.offsetWidth/2+"px";break;default:r.style.top=(a.pageY-o.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",r.style.left=(a.pageX-o.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return r.style.backgroundColor=l.color,r.className="waves-ripple z-active",!1}}return e[i]?e[i].removeHandle=a:e[i]={removeHandle:a},a}var n={bind:function(e,t){e.addEventListener("click",l(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[i].removeHandle,!1),e.addEventListener("click",l(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[i].removeHandle,!1),e[i]=null,delete e[i]}},o=function(e){e.directive("waves",n)};window.Vue&&(window.waves=n,Vue.use(o)),n.install=o},"8d41":function(e,t,a){},ad8f:function(e,t,a){"use strict";a.d(t,"d",function(){return l}),a.d(t,"e",function(){return n}),a.d(t,"a",function(){return o}),a.d(t,"g",function(){return r}),a.d(t,"b",function(){return s}),a.d(t,"f",function(){return c}),a.d(t,"c",function(){return u});var i=a("b775");function l(e){return Object(i["a"])({url:"/table/list",method:"get",params:e})}function n(e){return Object(i["a"])({url:"/table/list_detail",method:"get",params:e})}function o(e){return Object(i["a"])({url:"/table/store",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/table/update",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/table/delete",method:"post",data:e})}function c(){return Object(i["a"])({url:"table/synchronize",method:"post"})}function u(){return Object(i["a"])({url:"/table/list_commands",method:"get"})}},c48b:function(e,t,a){"use strict";a.d(t,"c",function(){return l}),a.d(t,"a",function(){return n}),a.d(t,"d",function(){return o}),a.d(t,"b",function(){return r});var i=a("b775");function l(e){return Object(i["a"])({url:"/database/list",method:"get",params:e})}function n(e){return Object(i["a"])({url:"/database/store",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/database/update",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/database/delete",method:"post",data:e})}}}]);